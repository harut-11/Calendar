<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Star Dodger Mobile</title>
<style>
html,body{
  margin:0;
  padding:0;
  height:100%;
  background:radial-gradient(circle at center, #000814, #001427);
  overflow:hidden;
  font-family:system-ui, sans-serif;
  color:#fff;
  -webkit-touch-callout:none;
  -webkit-user-select:none;
  user-select:none;
}
#gameCanvas{
  display:block;
  margin:0 auto;
  background:transparent;
  touch-action:none;
}
#ui{
  position:fixed;
  top:0;
  left:0;
  right:0;
  text-align:center;
  padding:10px;
  background:rgba(0,0,0,0.3);
  font-size:16px;
  z-index:10;
}
#startBtn{
  background:#ffd86b;
  border:none;
  border-radius:10px;
  padding:10px 20px;
  font-size:18px;
  font-weight:bold;
  color:#001427;
}
#info{
  font-size:14px;
  color:#ccc;
  margin-top:4px;
}
</style>
</head>
<body>
<div id="ui">
  <div>⭐ <b>Star Dodger Mobile</b></div>
  <button id="startBtn">START</button>
  <div id="info">左右スワイプで移動・星を集めて隕石を避けよう！</div>
</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let W = window.innerWidth, H = window.innerHeight;
canvas.width = W; canvas.height = H;

// プレイヤー設定
const player = {x:W/2, y:H-80, r:20, color:"#8be9fd", vx:0};
let score = 0, lives = 3, running = false, asteroids=[], stars=[];

// 音（モバイル対応はシンプル化）
function beep(){ if(window.navigator.vibrate) window.navigator.vibrate(20); }

// エンティティ生成
function spawnAsteroid(){
  asteroids.push({x:Math.random()*W, y:-40, r:Math.random()*20+15, vy:2+Math.random()*3});
}
function spawnStar(){
  stars.push({x:Math.random()*W, y:-20, r:10, vy:2});
}

// 衝突判定
function hit(a,b){let dx=a.x-b.x,dy=a.y-b.y;return dx*dx+dy*dy<(a.r+b.r)*(a.r+b.r);}

// 操作（タッチ＆スワイプ）
let touchX=null;
canvas.addEventListener("touchstart",e=>{
  touchX=e.touches[0].clientX;
});
canvas.addEventListener("touchmove",e=>{
  const x=e.touches[0].clientX;
  const dx=x-touchX;
  player.x += dx*0.4;
  touchX=x;
});
canvas.addEventListener("touchend",()=>{touchX=null;});

// メインループ
let last=0, asteroidTimer=0, starTimer=0;
function loop(t){
  if(!running) return;
  const dt=(t-last)/16.6; last=t;
  asteroidTimer+=dt; starTimer+=dt;

  if(asteroidTimer>20){spawnAsteroid(); asteroidTimer=0;}
  if(starTimer>60){spawnStar(); starTimer=0;}

  // 移動
  player.x=Math.max(player.r,Math.min(W-player.r,player.x));

  // 更新
  for(let a of asteroids){a.y+=a.vy*dt;}
  for(let s of stars){s.y+=s.vy*dt;}

  // 衝突処理
  for(let i=asteroids.length-1;i>=0;i--){
    const a=asteroids[i];
    if(hit(a,player)){asteroids.splice(i,1);lives--;beep();}
    if(a.y>H+50) asteroids.splice(i,1);
  }
  for(let i=stars.length-1;i>=0;i--){
    const s=stars[i];
    if(hit(s,player)){stars.splice(i,1);score+=10;}
    if(s.y>H+30) stars.splice(i,1);
  }

  if(lives<=0){gameOver();return;}

  draw();
  requestAnimationFrame(loop);
}

function draw(){
  ctx.clearRect(0,0,W,H);
  // 背景星
  ctx.fillStyle="rgba(255,255,255,0.05)";
  for(let i=0;i<60;i++){
    ctx.fillRect((i*31+Date.now()/50)%W,(i*47+Date.now()/70)%H,1,1);
  }
  // 隕石
  for(const a of asteroids){
    ctx.beginPath();
    ctx.arc(a.x,a.y,a.r,0,Math.PI*2);
    ctx.fillStyle="#888";
    ctx.fill();
  }
  // 星
  for(const s of stars){
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fillStyle="#ffd86b";
    ctx.fill();
  }
  // プレイヤー
  ctx.beginPath();
  ctx.moveTo(player.x,player.y-player.r);
  ctx.lineTo(player.x+player.r,player.y+player.r);
  ctx.lineTo(player.x-player.r,player.y+player.r);
  ctx.closePath();
  ctx.fillStyle=player.color;
  ctx.fill();

  // スコア
  ctx.fillStyle="#fff";
  ctx.font="bold 20px sans-serif";
  ctx.fillText(`Score: ${score}`,10,30);
  ctx.fillText(`Lives: ${lives}`,W-120,30);
}

function startGame(){
  score=0; lives=3; asteroids=[]; stars=[];
  running=true;
  last=performance.now();
  requestAnimationFrame(loop);
}

function gameOver(){
  running=false;
  alert(`Game Over!\nスコア: ${score}`);
}

document.getElementById("startBtn").onclick=()=>{
  if(!running) startGame();
};
window.addEventListener("resize",()=>{
  W=window.innerWidth;H=window.innerHeight;
  canvas.width=W;canvas.height=H;
  player.x=W/2;player.y=H-80;
});
</script>
</body>
</html>
